<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SH1106</title>
    <link rel="stylesheet" href="/css/pico.min.css">
</head>

<body>
    <header class="container">
        <h1>SH1106 Display tester</h1>
        <a role="button" href="/">Back</a>
    </header>
    <main class="container">
        <form>
            <input type="button" value="Check address (0x3c)" id="probe_btn">
            <input type="button" value="Turn on" id="on_btn">
            <input type="button" value="Turn off" id="off_btn">
            <input type="button" value="Fill all screen" id="fill_btn">
        </form>
    </main>
    <script src="/js/protobuf.min.js"></script>
    <script src="/js/lib/utils.js"></script>
    <script src="/js/lib/pb.js"></script>
    <script src="/js/lib/i2c.js"></script>
    <script>
        let bus;
        window.addEventListener('load', async (event) => {
            bus = await openI2CPromisified();
            console.log('The page has fully loaded');
        });
        
        document.getElementById("probe_btn").onclick = async () => {
            bus.probe(0x3C, 100000)
                .then((response) => { alert(response ? "Address exists\r\n" : "No device\r\n"); })
                .catch(() => { alert("Network error!\r\n") });
        }
        document.getElementById("on_btn").onclick = async () => {
            await bus.i2cWriteReg(0x3C, 0x80, [0xAF], 100000);
        }
        document.getElementById("off_btn").onclick = async () => {
            await bus.i2cWriteReg(0x3C, 0x80, [0xAE], 100000);
        }
        document.getElementById("fill_btn").onclick = async () => {
            for (let i = 0; i < 8; i++) {
                await bus.i2cWriteReg(0x3C, 0x80, [0xB0 + i], 100000);
                await bus.i2cWriteReg(0x3C, 0x80, [0x02], 100000);
                await bus.i2cWriteReg(0x3C, 0x80, [0x10], 100000);
                await bus.i2cWriteReg(0x3C, 0x40, [0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF], 100000);
            }
        }
    </script>
</body>

</html>